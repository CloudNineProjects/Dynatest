<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dynamax Helper</title>

<!-- CSV parser -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    /* same look as your template */
    --bg-light:#e6edea;
    --bg-dark:#0e1417;
    --card-light:linear-gradient(180deg,#2d8364,#16674c);
    --card-dark:linear-gradient(180deg,#1a2f2e,#10211d);
    --text-light:#0a0a0a;
    --text-dark:#f5f5f5;
    --accent:#2ac58d;
    --muted-light:#444;
    --muted-dark:#ccc;
    --glass:rgba(255,255,255,0.05);
  }

  html,body{
    height:100%;
    margin:0;
    font-family:"Inter",system-ui,Arial,sans-serif;
    transition:background .3s,color .3s;
  }
  body{
    background:var(--bg-light);
    color:var(--text-light);
  }
  body.dark{
    background:var(--bg-dark);
    color:var(--text-dark);
  }

  /* mode toggle */
  .mode-toggle{
    position:fixed;
    top:14px;
    right:14px;
    z-index:1200;
    background:rgba(255,255,255,0.9);
    color:#000;
    padding:8px 14px;
    border-radius:10px;
    cursor:pointer;
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
    user-select:none;
    font-size:14px;
  }
  body.dark .mode-toggle{
    background:rgba(0,0,0,0.7);
    color:#fff;
  }

  /* loading screen */
  .loader{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:20px;
    text-align:center;
  }
  .loader img.logo{
    width:200px;
    height:200px;
    border-radius:50%;
    object-fit:cover;
  }
  .load-btn{
    background:var(--accent);
    color:#fff;
    border:none;
    border-radius:10px;
    padding:12px 24px;
    font-size:16px;
    cursor:pointer;
    transition:opacity .2s;
  }
  .load-btn:hover{opacity:0.9;}
  .loading-text{font-size:15px;color:var(--muted-dark)}

  /* app layout: cards vertically stacked */
  .wrap{
    max-width:900px;
    margin:24px auto;
    padding:16px;
    display:flex;
    flex-direction:column;
    gap:18px;
  }
  .card{
    border-radius:16px;
    background:var(--card-light);
    color:#fff;
    padding:20px;
    box-shadow:0 8px 26px rgba(0,0,0,0.15);
    transition:transform .15s ease;
  }
  .card:hover{transform:translateY(-3px);}
  body.dark .card{background:var(--card-dark);}

  h1{margin-top:0;font-size:20px}
  label{display:block;margin:10px 0 6px;font-weight:500}
  select,button{
    width:100%;
    box-sizing:border-box;
    padding:10px 12px;
    border-radius:8px;
    border:none;
    font-size:15px;
  }
  select{
    background:#fff;
    color:#000;
  }
  body.dark select{
    background:#000;
    color:#fff;
    border:1px solid rgba(255,255,255,0.1);
  }
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:6px}
  .controls button{
    width:auto;
    padding:10px 16px;
    background:#fff;
    color:#000;
    cursor:pointer;
    border-radius:8px;
  }
  body.dark .controls button{
    background:#111;
    color:#fff;
  }
  .results{
    margin-top:12px;
    background:var(--glass);
    padding:12px;
    border-radius:10px;
    color:inherit;
  }
  pre.preserve{
    white-space:pre-wrap;
    margin:0;
    font-family:inherit;
  }
  table{
    width:100%;
    border-collapse:collapse;
    font-size:14px;
  }
  th,td{
    padding:6px 8px;
    border-bottom:1px solid rgba(255,255,255,0.08);
    vertical-align:top;
  }
  th{background:rgba(0,0,0,0.08);position:sticky;top:0;z-index:3;}
  .badge{
    display:inline-block;
    padding:6px 10px;
    background:rgba(255,255,255,0.1);
    border-radius:999px;
    margin:4px 6px 4px 0;
    font-size:13px;
  }

  /* color coding for type chart */
  .cell-strong{background:#b42c2c;color:#fff;font-weight:600}
  .cell-resist{background:#206699;color:#fff;}
  .cell-immune{background:#444;color:#fff;}
  .cell-normal{background:transparent;color:inherit;}
  .cell-other{background:rgba(255,255,255,0.05)}

</style>
</head>
<body>
<div id="modeToggle" class="mode-toggle">ðŸŒ™ Dark Mode</div>

<!-- Loading screen -->
<div id="loading" class="loader">
  <img class="logo" src="https://i.imgur.com/XZcfQzw.png" alt="Logo">
  <button id="loadBtn" class="load-btn">Load Data</button>
  <div id="loadingText" class="loading-text" style="display:none">Loading...</div>
</div>

<!-- App -->
<div id="app" class="wrap" style="display:none">

  <!-- Card 1 -->
  <div class="card">
    <h1>Dynamax Info</h1>
    <label for="infoFilter">Filter (Column A: type)</label>
    <select id="infoFilter"><option value="">-- select --</option></select>
    <div class="controls">
      <button id="infoShow">Show</button>
      <button id="infoReset">Reset</button>
    </div>
    <div id="infoOut" class="results" style="display:none"></div>
  </div>

  <!-- Card 2 -->
  <div class="card">
    <h1>Dynamax Database</h1>
    <label for="dbFilter">Filter (Column A)</label>
    <select id="dbFilter"><option value="">-- select --</option></select>
    <div class="controls">
      <button id="dbShow">Show</button>
      <button id="dbReset">Reset</button>
    </div>
    <div id="dbOut" class="results" style="display:none"></div>
  </div>

  <!-- Card 3 -->
  <div class="card">
    <h1>Dynamax Move</h1>
    <label for="moveFilter">Filter (Column A)</label>
    <select id="moveFilter"><option value="">-- select --</option></select>
    <div class="controls">
      <button id="moveShow">Show</button>
      <button id="moveReset">Reset</button>
    </div>
    <div id="moveOut" class="results" style="display:none"></div>
  </div>

  <!-- Card 4 -->
  <div class="card">
    <h1>Attack Check</h1>
    <label for="atkDef1">Defender 1</label>
    <select id="atkDef1"><option value="">-- select --</option></select>
    <label for="atkDef2">Defender 2 (optional)</label>
    <select id="atkDef2"><option value="">-- select --</option></select>
    <div class="controls">
      <button id="atkShow">Show</button>
      <button id="atkReset">Reset</button>
    </div>
    <div id="atkOut" class="results" style="display:none"></div>

    <hr style="margin:16px 0;border:none;border-top:1px solid rgba(255,255,255,0.1)">

    <h1>Defense Check</h1>
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px">
      <select id="def1"><option value="">-- Move 1 --</option></select>
      <select id="def2"><option value="">-- Move 2 --</option></select>
      <select id="def3"><option value="">-- Move 3 --</option></select>
      <select id="def4"><option value="">-- Move 4 --</option></select>
    </div>
    <div class="controls" style="margin-top:8px">
      <button id="defShow">Show</button>
      <button id="defReset">Reset</button>
    </div>
    <div id="defOut" class="results" style="display:none;overflow-y:auto;max-height:420px"></div>
  </div>

</div>

<script>
const $ = id => document.getElementById(id);
const escapeHtml = s => s==null?'':String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");

function normalizeValue(v){
  if(v==null) return '';
  const s=String(v).trim();
  if(!s) return '';
  if(/^(2|2\.0)$/i.test(s)) return '2';
  if(/^(1|1\.0)$/i.test(s)) return '1';
  if(/^(0\.5|Â½|1\/2)$/i.test(s)) return '0.5';
  if(/^(0|immune|x0)$/i.test(s.toLowerCase())) return '0';
  return s;
}
function valueClass(v){
  const n=normalizeValue(v);
  if(n==='2') return 'cell-strong';
  if(n==='0.5') return 'cell-resist';
  if(n==='0') return 'cell-immune';
  if(n==='1') return 'cell-normal';
  return 'cell-other';
}

/* CSV URLs */
const URL_INFO="https://docs.google.com/spreadsheets/d/e/2PACX-1vRKBJf3BXL7kqLIu8WAZCiFIBqNTMVvWCmkRA2kVoC30QskuIRkxwUKJJnrHKh2Y8I18iZ0p068wRD2/pub?output=csv";
const URL_DB="https://docs.google.com/spreadsheets/d/e/2PACX-1vRGq_ta_VKuhpNif51aoWSm2XKE04CHREcDqGObDZnBQ0kK3Yo-_Bz7i7u1oP1Xv9pRm0-xN7dDgyiT/pub?output=csv";
const URL_MOVE="https://docs.google.com/spreadsheets/d/e/2PACX-1vRfBHLwHVULXabVXPztSXOz-36oGnjJFxuHyhgftVYg3Ft_f7VqkVwfpdmQwrfZEXrdjCKnydJBqRHt/pub?output=csv";
const URL_ATTACK="https://docs.google.com/spreadsheets/d/e/2PACX-1vQUYm_GBIYmou5lzjHIeXmz9GlP0d4_z3g6Jxrpof_DvIBFdOh8bL4dNF8v4T2Vn5sseu8zOhRzP74O/pub?output=csv";

let infoRows=[],infoFields=[],dbRows=[],dbFields=[],moveRows=[],moveFields=[],atkRows=[],atkFields=[];

function showLoading(msg){$('loadingText').style.display='block';$('loadingText').textContent=msg||'Loading...';}
function hideLoading(){$('loadingText').style.display='none';}

function parseCSV(url){
  return new Promise((resolve,reject)=>{
    Papa.parse(url,{
      download:true,
      header:true,
      skipEmptyLines:true,
      complete:(res)=>resolve({data:res.data,fields:res.meta.fields||[]}),
      error:(err)=>reject(err)
    });
  });
}

function loadAll(){
  $('loadBtn').disabled=true;
  showLoading('Loading sheets...');
  Promise.all([
    parseCSV(URL_INFO).then(r=>{infoRows=r.data;infoFields=r.fields}),
    parseCSV(URL_DB).then(r=>{dbRows=r.data;dbFields=r.fields}),
    parseCSV(URL_MOVE).then(r=>{moveRows=r.data;moveFields=r.fields}),
    parseCSV(URL_ATTACK).then(r=>{atkRows=r.data;atkFields=r.fields})
  ]).then(()=>{
    hideLoading();
    $('loading').style.display='none';
    $('app').style.display='flex';
    populateFilters();
  }).catch(e=>{
    console.error(e);
    $('loadingText').textContent='Error loading sheets';
    $('loadBtn').disabled=false;
  });
}

function uniqueFromColumn(rows,col){
  const s=new Set();
  rows.forEach(r=>{const v=(r[col]||'').trim();if(v)s.add(v);});
  return [...s].sort((a,b)=>a.localeCompare(b));
}

function populateSelect(sel,items,placeholder){
  sel.innerHTML='';
  const ph=document.createElement('option');
  ph.value='';ph.textContent=placeholder||'-- select --';
  sel.appendChild(ph);
  items.forEach(it=>{
    const o=document.createElement('option');
    o.value=it;o.textContent=it;
    sel.appendChild(o);
  });
}

function populateFilters(){
  const infoA=infoFields[0];populateSelect($('infoFilter'),uniqueFromColumn(infoRows,infoA),'-- select --');
  const dbA=dbFields[0];populateSelect($('dbFilter'),uniqueFromColumn(dbRows,dbA),'-- select --');
  const moveA=moveFields[0];populateSelect($('moveFilter'),uniqueFromColumn(moveRows,moveA),'-- select --');
  const defenders=atkFields.slice(1);
  populateSelect($('atkDef1'),defenders,'-- Defender --');
  populateSelect($('atkDef2'),defenders,'-- Defender (opt.) --');
  const moveNames=uniqueFromColumn(atkRows,atkFields[0]);
  ['def1','def2','def3','def4'].forEach(id=>populateSelect($(id),moveNames,'-- Move --'));
}

/* Render helpers */
function renderPre(s){return `<pre class="preserve">${escapeHtml(s||'')}</pre>`;}
function renderTable(rows,fields,cols){
  let h='<div style="overflow:auto"><table><thead><tr>';
  cols.forEach(c=>h+=`<th>${escapeHtml(c)}</th>`);h+='</tr></thead><tbody>';
  rows.forEach(r=>{
    h+='<tr>';
    cols.forEach(c=>{
      const v=r[c]||'';
      const cls=valueClass(v);
      const content=v.includes('\n')?`<pre class="preserve">${escapeHtml(v)}</pre>`:escapeHtml(v);
      h+=`<td class="${cls}">${content}</td>`;
    });
    h+='</tr>';
  });
  h+='</tbody></table></div>';
  return h;
}

/* Card 1 */
$('infoShow').onclick=()=>{
  const sel=$('infoFilter').value;if(!sel)return alert('Select a filter');
  const colA=infoFields[0],colB=infoFields[1];
  const matches=infoRows.filter(r=>(r[colA]||'').trim()===sel);
  let html=matches.map(m=>renderPre(m[colB]||'')).join('<hr>');
  $('infoOut').innerHTML=html;$('infoOut').style.display='block';
};
$('infoReset').onclick=()=>{$('infoFilter').selectedIndex=0;$('infoOut').style.display='none';};

/* Card 2 */
$('dbShow').onclick=()=>{
  const sel=$('dbFilter').value;if(!sel)return alert('Select a filter');
  const colA=dbFields[0];
  const matches=dbRows.filter(r=>(r[colA]||'').trim()===sel);
  $('dbOut').innerHTML=renderTable(matches,dbFields,dbFields.slice(1,7));
  $('dbOut').style.display='block';
};
$('dbReset').onclick=()=>{$('dbFilter').selectedIndex=0;$('dbOut').style.display='none';};

/* Card 3 */
$('moveShow').onclick=()=>{
  const sel=$('moveFilter').value;if(!sel)return alert('Select a filter');
  const colA=moveFields[0],colB=moveFields[1];
  const matches=moveRows.filter(r=>(r[colA]||'').trim()===sel);
  $('moveOut').innerHTML=matches.map(m=>renderPre(m[colB]||'')).join('<hr>');
  $('moveOut').style.display='block';
};
$('moveReset').onclick=()=>{$('moveFilter').selectedIndex=0;$('moveOut').style.display='none';};

/* Attack Check */
$('atkShow').onclick=()=>{
  const sel1=$('atkDef1').value,sel2=$('atkDef2').value;
  if(!sel1&&!sel2)return alert('Select at least one defender');
  const cols=[sel1,sel2].filter(Boolean);
  const rowLabel=atkFields[0];
  const results=[];
  atkRows.forEach(r=>{
    const vals=cols.map(c=>normalizeValue(r[c]||''));
    if(cols.length===1){
      if(vals[0]==='2')results.push(r[rowLabel]);
    }else{
      const has2=vals.includes('2');
      const has1or2=vals.some(v=>v==='1'||v==='2');
      if(has2&&has1or2)results.push(r[rowLabel]);
    }
  });
  $('atkOut').innerHTML=results.length?results.map(x=>`<span class="badge">${escapeHtml(x)}</span>`).join(' '):'<p>No results.</p>';
  $('atkOut').style.display='block';
};
$('atkReset').onclick=()=>{$('atkDef1').selectedIndex=0;$('atkDef2').selectedIndex=0;$('atkOut').style.display='none';};

/* Defense Check */
$('defShow').onclick=()=>{
  const names=['def1','def2','def3','def4'].map(id=>$(id).value).filter(Boolean);
  if(!names.length)return alert('Select at least one move');
  const rowLabel=atkFields[0];
  const matches=atkRows.filter(r=>names.includes((r[rowLabel]||'').trim()));
  const cols=atkFields.slice(0,19);
  $('defOut').innerHTML=renderTable(matches,atkFields,cols);
  $('defOut').style.display='block';
};
$('defReset').onclick=()=>{['def1','def2','def3','def4'].forEach(id=>$(id).selectedIndex=0);$('defOut').style.display='none';};

/* mode toggle */
const modeToggle=$('modeToggle');
function updateModeLabel(){modeToggle.textContent=document.body.classList.contains('dark')?'â˜€ï¸ Light Mode':'ðŸŒ™ Dark Mode';}
modeToggle.onclick=()=>{document.body.classList.toggle('dark');updateModeLabel();};
updateModeLabel();

$('loadBtn').onclick=loadAll;
</script>
</body>
</html>
